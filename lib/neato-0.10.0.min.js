/**
 *  Neato SDK Javascript
 *  https://github.com/NeatoRobotics/neato-sdk-js
 *
 *  Copyright (c)2016 Neato Robotics, Inc.
 *  Author: Roberto Ostinelli
 *
 *  Version: 0.10.0
 */
var Neato={user:null,Services:{},Constants:{CLEAN_HOUSE_MODE:2,CLEAN_SPOT_MODE:3,CLEAN_MAP_MODE:4,MANUAL_CLEANING_MODE:1,ECO_MODE:1,TURBO_MODE:2,SPOT_AREA_SMALL:200,SPOT_AREA_LARGE:400,HOUSE_FREQUENCY_NORMAL:1,HOUSE_FREQUENCY_DOUBLE:2,SPOT_FREQUENCY_NORMAL:1,SPOT_FREQUENCY_DOUBLE:2,EXTRA_CARE_OFF:1,EXTRA_CARE_ON:2}};Neato.utils={haveEqualProps:function(e,t){var n;for(n in e)if("undefined"==typeof t[n])return!1;for(n in e)if(e[n])switch(typeof e[n]){case"object":if(!this.haveEqualProps(e[n],t[n]))return!1;break;case"function":if("undefined"==typeof t[n]||"equals"!=n&&e[n].toString()!=t[n].toString())return!1;break;default:if(e[n]!=t[n])return!1}else if(t[n])return!1;for(n in t)if("undefined"==typeof e[n])return!1;return!0},clone:function(e,t){var n={},a=(t=t||{}).except,r=t.only;for(var s in e)!e.hasOwnProperty(s)||-1!==$.inArray(s,a)||void 0!==r&&-1===$.inArray(s,r)||(n[s]=e[s]);return n},isNullOrEmptyJSON:function(e){return null==e||!!jQuery.isEmptyObject(e)}},Neato.User=function(){this.initialize.apply(this,arguments)},Neato.User.prototype={initialize:function(){this.__parseRedirectURIResponse(),this.host="beehive.neatocloud.com",this.oauthHost="apps.neatorobotics.com",this.robots=[],Neato.user=this},getUserInfo:function(){return this.__call("GET","/users/me")},__getRobotMaps:function(e){return this.__call("GET","/users/me/robots/"+e+"/maps")},__getMapDetails:function(e,t){return this.__call("GET","/users/me/robots/"+e+"/maps/"+t)},__getRobotPersistentMaps:function(e){return this.__call("GET","/users/me/robots/"+e+"/persistent_maps")},getRobots:function(){var n=this,a=$.Deferred();return this.__call("GET","/users/me/robots").done(function(e){n.robots=[];for(var t=0;t<e.length;t++)e[t].linked_at&&n.robots.push(new Neato.Robot(e[t].serial,e[t].secret_key,{name:e[t].name,model:e[t].model}));a.resolve.call(n,n.robots)}).fail(function(e){a.reject.call(n,e)}),a},getRobotBySerial:function(e){for(var t=0;t<this.robots.length;t++)if(0==this.robots[t].serial.localeCompare(e))return this.robots[t];return null},login:function(e){e=e||{};var t="https://"+this.oauthHost+"/oauth2/authorize?client_id="+e.clientId+"&scope="+e.scopes+"&response_type=token&redirect_uri="+e.redirectUrl;this.__navigateToURL(t)},logout:function(){var e=this;return this.__call("POST","/oauth2/revoke",{token:e.token})},isConnected:function(){var e=this,t=$.Deferred();return this.__sessionsCheck().done(function(){e.connected=!0,t.resolve.call(e,!0)}).fail(function(){e.connected=!1,t.reject.call(e,!1)}),t},authenticationError:function(){return this.authError!=undefined},__sessionsCheck:function(){return this.__call("GET","/users/me")},__navigateToURL:function(e){location.replace(e)},__parseRedirectURIResponse:function(){var e=document.location.hash.replace("#","").split("&"),a=this;e.forEach(function(e){var t=e.split("=")[0]||"",n=e.split("=")[1]||"";0==t.localeCompare("access_token")?a.token=n:0==t.localeCompare("error")?a.authError=n:0==t.localeCompare("error_description")&&(a.authErrorDescription=n.replace(/\+/g," "))})},__call:function(e,t,n){n=0==e.localeCompare("GET")?n||null:n||{};var a=this,r=$.Deferred(),s="https://"+this.host+t,o="application/vnd.neato.beehive.v1+json",i=(new Date).toUTCString(),c=null==n?null:JSON.stringify(n),l="Bearer "+this.token;return $.ajax({crossDomain:!0,dataType:"json",method:e,url:s,headers:{Accept:o,Authorization:l,"X-Date":i,"Content-type":"application/json"},data:c}).done(function(e,t,n){r.resolve.call(a,n.responseJSON)}).fail(function(e){r.reject.call(a,e.responseJSON)}),r}},Neato.Robot=function(){this.initialize.apply(this,arguments)},Neato.Robot.prototype={initialize:function(e,t,n){this.serial=e,this.secretKey=t,n=n||{},this.host="nucleo.neatocloud.com",this.port=4443,this.onConnected=n.onConnected,this.onDisconnected=n.onDisconnected,this.onStateChange=n.onStateChange,this.name=n.name,this.model=n.model},connect:function(){var e=this;this.timer=setInterval(function(){e.getState.apply(e)},3e3),this.getState()},disconnect:function(){clearInterval(this.timer),delete this.timer,this.__disconnect()},getMapBoundaries:function(e){var t={reqId:"77",cmd:"getMapBoundaries",params:{mapId:e}};return this.__call(t)},getState:function(){var e={reqId:"1",cmd:"getRobotState"};return this.__call(e)},__call:function(e){var s=this,o=$.Deferred(),t="https://"+this.host+":"+this.port+"/vendors/neato/robots/"+this.serial+"/messages",n="application/vnd.neato.nucleo.v1",a=(new Date).toUTCString(),r=JSON.stringify(e),i=this.serial.toLowerCase()+"\n"+a+"\n"+r,c="NEATOAPP "+CryptoJS.HmacSHA256(i,this.secretKey);return $.ajax({crossDomain:!0,dataType:"json",method:"POST",url:t,headers:{Accept:n,Authorization:c,"X-Date":a},data:r}).done(function(e,t,n){var a=n.responseJSON;s.__setState(a);var r=s.__extractReplyFromReponse(a);"ok"==r.result?o.resolve.call(s,r.result,r.data):o.reject.call(s,r.result,r.data)}).fail(function(e){s.__disconnect(e.status,e.responseJSON)}),o},__setState:function(e){if("undefined"!=typeof e.state){var t=Neato.utils.clone(e,{except:["version","reqId","result","data"]}),n="undefined"==typeof this.state,a=n||!Neato.utils.haveEqualProps(this.state,t);this.state=t,n&&this.onConnected&&this.onConnected(),a&&this.onStateChange&&(this.onStateChange(),this.__initializeAvailableServices())}},__initializeAvailableServices:function(){for(var e in this.state.availableServices)this.__extend(Neato.Services[e+"_"+this.state.availableServices[e].replace("-","")])},__disconnect:function(e,t){delete this.state,this.onDisconnected&&this.onDisconnected(e,t)},__extractReplyFromReponse:function(e){return Neato.utils.clone(e,{only:["result","data"]})},__extend:function(e){for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t])}},Neato.Robot.extend=function(e){for(var t in e)e.hasOwnProperty(t)&&(Neato.Robot.prototype[t]=e[t])},Neato.Services.cleaning={stopCleaning:function(){var e={reqId:"1",cmd:"stopCleaning"};return this.__call(e)},pauseCleaning:function(){var e={reqId:"1",cmd:"pauseCleaning"};return this.__call(e)},resumeCleaning:function(){var e={reqId:"1",cmd:"resumeCleaning"};return this.__call(e)},sendToBase:function(){var e={reqId:"1",cmd:"sendToBase"};return this.__call(e)}},Neato.Services.houseCleaning_basic1={startHouseCleaning:function(e){e=e||{};var t={reqId:"1",cmd:"startCleaning",params:{category:Neato.Constants.CLEAN_HOUSE_MODE,mode:e.mode||Neato.Constants.TURBO_MODE,modifier:e.modifier||Neato.Constants.HOUSE_FREQUENCY_NORMAL}};return this.__call(t)},supportEcoTurboMode:function(){return!0},supportFrequency:function(){return!0},supportExtraCare:function(){return!1},stopCleaning:Neato.Services.cleaning.stopCleaning,pauseCleaning:Neato.Services.cleaning.pauseCleaning,resumeCleaning:Neato.Services.cleaning.resumeCleaning,sendToBase:Neato.Services.cleaning.sendToBase},Neato.Services.houseCleaning_basic2={startHouseCleaning:function(e){e=e||{};var t={reqId:"1",cmd:"startCleaning",params:{category:Neato.Constants.CLEAN_HOUSE_MODE,mode:e.mode||Neato.Constants.TURBO_MODE,modifier:e.modifier||Neato.Constants.HOUSE_FREQUENCY_NORMAL,navigationMode:e.navigationMode||Neato.Constants.EXTRA_CARE_OFF}};return this.__call(t)},supportEcoTurboMode:function(){return!0},supportFrequency:function(){return!0},supportExtraCare:function(){return!0},stopCleaning:Neato.Services.cleaning.stopCleaning,pauseCleaning:Neato.Services.cleaning.pauseCleaning,resumeCleaning:Neato.Services.cleaning.resumeCleaning,sendToBase:Neato.Services.cleaning.sendToBase},Neato.Services.houseCleaning_basic3={startHouseCleaning:function(e){e=e||{};var t={reqId:"1",cmd:"startCleaning",params:{category:Neato.Constants.CLEAN_HOUSE_MODE,mode:e.mode||Neato.Constants.TURBO_MODE,navigationMode:e.navigationMode||Neato.Constants.EXTRA_CARE_OFF}};return this.__call(t)},supportEcoTurboMode:function(){return!0},supportFrequency:function(){return!1},supportExtraCare:function(){return!0},stopCleaning:Neato.Services.cleaning.stopCleaning,pauseCleaning:Neato.Services.cleaning.pauseCleaning,resumeCleaning:Neato.Services.cleaning.resumeCleaning,sendToBase:Neato.Services.cleaning.sendToBase},Neato.Services.houseCleaning_basic4={startHouseCleaning:function(e){e=e||{};var t={reqId:"1",cmd:"startCleaning",params:{category:Neato.Constants.CLEAN_HOUSE_MODE,mode:e.mode||Neato.Constants.TURBO_MODE,navigationMode:e.navigationMode||Neato.Constants.EXTRA_CARE_OFF}};return e.boundaryId&&(t.params.category=Neato.Constants.CLEAN_MAP_MODE,t.params.boundaryId=e.boundaryId),this.__call(t)},supportEcoTurboMode:function(){return!0},supportFrequency:function(){return!0},supportExtraCare:function(){return!0},stopCleaning:Neato.Services.cleaning.stopCleaning,pauseCleaning:Neato.Services.cleaning.pauseCleaning,resumeCleaning:Neato.Services.cleaning.resumeCleaning,sendToBase:Neato.Services.cleaning.sendToBase},Neato.Services.houseCleaning_minimal2={startHouseCleaning:function(e){e=e||{};var t={reqId:"1",cmd:"startCleaning",params:{category:Neato.Constants.CLEAN_HOUSE_MODE,navigationMode:e.navigationMode||Neato.Constants.EXTRA_CARE_OFF}};return this.__call(t)},supportEcoTurboMode:function(){return!1},supportFrequency:function(){return!1},supportExtraCare:function(){return!0},stopCleaning:Neato.Services.cleaning.stopCleaning,pauseCleaning:Neato.Services.cleaning.pauseCleaning,resumeCleaning:Neato.Services.cleaning.resumeCleaning,sendToBase:Neato.Services.cleaning.sendToBase},Neato.Services.spotCleaning_basic1={startSpotCleaning:function(e){e=e||{};var t={reqId:"1",cmd:"startCleaning",params:{category:Neato.Constants.CLEAN_SPOT_MODE,mode:e.mode||Neato.Constants.TURBO_MODE,modifier:e.modifier||Neato.Constants.HOUSE_FREQUENCY_NORMAL,spotWidth:e.spotWidth||Neato.Constants.SPOT_AREA_LARGE,spotHeight:e.spotHeight||Neato.Constants.SPOT_AREA_LARGE}};return this.__call(t)},supportEcoTurboMode:function(){return!0},supportFrequency:function(){return!0},supportExtraCare:function(){return!1},supportArea:function(){return!0},stopCleaning:Neato.Services.cleaning.stopCleaning,pauseCleaning:Neato.Services.cleaning.pauseCleaning,resumeCleaning:Neato.Services.cleaning.resumeCleaning,sendToBase:Neato.Services.cleaning.sendToBase},Neato.Services.spotCleaning_basic2={startSpotCleaning:function(e){e=e||{};var t={reqId:"1",cmd:"startCleaning",params:{category:Neato.Constants.CLEAN_SPOT_MODE,mode:e.mode||Neato.Constants.TURBO_MODE,modifier:e.modifier||Neato.Constants.HOUSE_FREQUENCY_NORMAL,spotWidth:e.spotWidth||Neato.Constants.SPOT_AREA_LARGE,spotHeight:e.spotHeight||Neato.Constants.SPOT_AREA_LARGE,navigationMode:e.navigationMode||Neato.Constants.EXTRA_CARE_OFF}};return this.__call(t)},supportEcoTurboMode:function(){return!0},supportFrequency:function(){return!0},supportExtraCare:function(){return!0},supportArea:function(){return!0},stopCleaning:Neato.Services.cleaning.stopCleaning,pauseCleaning:Neato.Services.cleaning.pauseCleaning,resumeCleaning:Neato.Services.cleaning.resumeCleaning,sendToBase:Neato.Services.cleaning.sendToBase},Neato.Services.spotCleaning_basic3={startSpotCleaning:function(e){e=e||{};var t={reqId:"1",cmd:"startCleaning",params:{category:Neato.Constants.CLEAN_SPOT_MODE,mode:e.mode||Neato.Constants.TURBO_MODE,modifier:e.modifier||Neato.Constants.HOUSE_FREQUENCY_NORMAL,spotWidth:e.spotWidth||Neato.Constants.SPOT_AREA_LARGE,spotHeight:e.spotHeight||Neato.Constants.SPOT_AREA_LARGE,navigationMode:e.navigationMode||Neato.Constants.EXTRA_CARE_OFF}};return this.__call(t)},supportEcoTurboMode:function(){return!0},supportFrequency:function(){return!0},supportExtraCare:function(){return!0},supportArea:function(){return!0},stopCleaning:Neato.Services.cleaning.stopCleaning,pauseCleaning:Neato.Services.cleaning.pauseCleaning,resumeCleaning:Neato.Services.cleaning.resumeCleaning,sendToBase:Neato.Services.cleaning.sendToBase},Neato.Services.spotCleaning_micro2={startSpotCleaning:function(e){e=e||{};var t={reqId:"1",cmd:"startCleaning",params:{category:Neato.Constants.CLEAN_SPOT_MODE,navigationMode:e.navigationMode||Neato.Constants.EXTRA_CARE_OFF}};return this.__call(t)},supportEcoTurboMode:function(){return!1},supportFrequency:function(){return!1},supportExtraCare:function(){return!0},supportArea:function(){return!1},stopCleaning:Neato.Services.cleaning.stopCleaning,pauseCleaning:Neato.Services.cleaning.pauseCleaning,resumeCleaning:Neato.Services.cleaning.resumeCleaning,sendToBase:Neato.Services.cleaning.sendToBase},Neato.Services.spotCleaning_minimal2={startSpotCleaning:function(e){e=e||{};var t={reqId:"1",cmd:"startCleaning",params:{category:Neato.Constants.CLEAN_SPOT_MODE,modifier:e.modifier||Neato.Constants.HOUSE_FREQUENCY_NORMAL,navigationMode:e.navigationMode||Neato.Constants.EXTRA_CARE_OFF}};return this.__call(t)},supportEcoTurboMode:function(){return!1},supportFrequency:function(){return!0},supportExtraCare:function(){return!0},supportArea:function(){return!1},stopCleaning:Neato.Services.cleaning.stopCleaning,pauseCleaning:Neato.Services.cleaning.pauseCleaning,resumeCleaning:Neato.Services.cleaning.resumeCleaning,sendToBase:Neato.Services.cleaning.sendToBase},Neato.Services.findMe_basic1={findMe:function(){var e={reqId:"1",cmd:"findMe"};return this.__call(e)}},Neato.Services.generalInfo_advanced1={generalInfo:function(){var e={reqId:"1",cmd:"getGeneralInfo"};return this.__call(e)}},Neato.Services.generalInfo_basic1={generalInfo:function(){var e={reqId:"1",cmd:"getGeneralInfo"};return this.__call(e)}},Neato.Services.localStats_advanced1={localStats:function(){var e={reqId:"1",cmd:"getLocalStats"};return this.__call(e)}},Neato.Services.maps_advanced2={maps:function(){return Neato.user.__getRobotMaps(this.serial)},mapDetails:function(e){return Neato.user.__getMapDetails(this.serial,e)},persistentMaps:function(){return Neato.user.__getRobotPersistentMaps(this.serial)}},Neato.Services.maps_basic1={maps:function(){return Neato.user.__getRobotMaps(this.serial)},mapDetails:function(e){return Neato.user.__getMapDetails(this.serial,e)}},Neato.Services.maps_basic2={maps:function(){return Neato.user.__getRobotMaps(this.serial)},mapDetails:function(e){return Neato.user.__getMapDetails(this.serial,e)},persistentMaps:function(){return Neato.user.__getRobotPersistentMaps(this.serial)}},Neato.Services.maps_macro1={maps:function(){return Neato.user.__getRobotMaps(this.serial)},mapDetails:function(e){return Neato.user.__getMapDetails(this.serial,e)},persistentMaps:function(){return Neato.user.__getRobotPersistentMaps(this.serial)}},Neato.Services.preferences_advanced1={getPreferences:function(){var e={reqId:"1",cmd:"getPreferences"};return this.__call(e)},setPreferences:function(e){var t={reqId:"1",cmd:"setPreferences",params:{robotSounds:(e=e||{}).robotSounds||!1,dirtbinAlert:e.dirtbinAlert||!1,allAlerts:e.allAlerts||!1,leds:e.leds||!1,buttonClicks:e.buttonClicks||!1,dirtbinAlertReminderInterval:e.dirtbinAlertReminderInterval||150,filterChangeReminderInterval:e.filterChangeReminderInterval||43200,brushChangeReminderInterval:e.brushChangeReminderInterval||172800,clock24h:e.clock24h||!1,locale:e.locale||"en"}};return this.__call(t)}},Neato.Services.preferences_basic1={getPreferences:function(){var e={reqId:"1",cmd:"getPreferences"};return this.__call(e)},setPreferences:function(e){var t={reqId:"1",cmd:"setPreferences",params:{dirtbinAlertReminderInterval:(e=e||{}).dirtbinAlertReminderInterval||150,filterChangeReminderInterval:e.filterChangeReminderInterval||43200,brushChangeReminderInterval:e.brushChangeReminderInterval||172800}};return this.__call(t)}},Neato.Services.schedule_basic1={setSchedule:function(e){e=e||{};var t={reqId:"1",cmd:"setSchedule",params:{type:1,events:$.map(e,function(e,t){return{mode:e.mode||Neato.Constants.TURBO_MODE,day:parseInt(t,10),startTime:e.startTime}})}};return this.__call(t)},getSchedule:function(){var e={reqId:"1",cmd:"getSchedule"};return this.__call(e)},enableSchedule:function(){var e={reqId:"1",cmd:"enableSchedule"};return this.__call(e)},disableSchedule:function(){var e={reqId:"1",cmd:"disableSchedule"};return this.__call(e)}},Neato.Services.schedule_basic2={setSchedule:function(e){e=e||{};var t={reqId:"1",cmd:"setSchedule",params:{type:1,events:$.map(e,function(e,t){return{mode:e.mode||Neato.Constants.TURBO_MODE,day:parseInt(t,10),startTime:e.startTime}})}};return this.__call(t)},getSchedule:function(){var e={reqId:"1",cmd:"getSchedule"};return this.__call(e)},enableSchedule:function(){var e={reqId:"1",cmd:"enableSchedule"};return this.__call(e)},disableSchedule:function(){var e={reqId:"1",cmd:"disableSchedule"};return this.__call(e)}},Neato.Services.schedule_minimal1={setSchedule:function(e){e=e||{};var t={reqId:"1",cmd:"setSchedule",params:{type:1,events:$.map(e,function(e,t){return{day:parseInt(t,10),startTime:e.startTime}})}};return this.__call(t)},getSchedule:function(){var e={reqId:"1",cmd:"getSchedule"};return this.__call(e)},enableSchedule:function(){var e={reqId:"1",cmd:"enableSchedule"};return this.__call(e)},disableSchedule:function(){var e={reqId:"1",cmd:"disableSchedule"};return this.__call(e)}},Neato.Services.wifi_basic1={getWifiNetworks:function(){var e={reqId:"1",cmd:"getWifiNetworks"};return this.__call(e)},setWifiNetwork:function(e){var t={reqId:"1",cmd:"setWifiNetwork",params:{ssid:(e=e||{}).ssid||""}};return this.__call(t)},addWifiNetwork:function(e){var t={reqId:"1",cmd:"addWifiNetwork",params:{ssid:(e=e||{}).ssid||"",password:e.password||""}};return this.__call(t)},removeWifiNetwork:function(e){var t={reqId:"1",cmd:"removeWifiNetwork",params:{ssid:(e=e||{}).ssid||""}};return this.__call(t)},getAvailableWifiNetworks:function(){var e={reqId:"1",cmd:"getAvailableWifiNetworks"};return this.__call(e)},resetWifiNetworks:function(){var e={reqId:"1",cmd:"resetWifiNetworks"};return this.__call(e)}};
